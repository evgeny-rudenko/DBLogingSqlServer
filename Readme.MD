# Логирование в БД MS SQL Server 

Руденко Евгений
+79098040505
## Для чего 

Логируем и восстанавливаем значения из таблиц при вставке и удалении данных

Задание


>Необходимо написать хранимую процедуру, которая будет принимать id записи лога и восстанавливать состояние соответствующей строки в таблице.
>Важны два фактора:
>- время решения,
>- универсальность решения 
>(работа процедуры при различных возможных ситуациях, либо указать, какие случаи процедура не учитывает, т.е. рамки ее применимости).



Для универсального использования решения одной процедуры будет недостаточно.
## Что будем делать:

### Основная часть
* Процедура автоматического создания триггера AFTER INSERT, DELETE по данным из таблицы TablesForLogging
* Процедура для отката на одно изменение / отката на момент времени



### Дополнительная для облегчения жизни и чтобы проект имел функциональность для использования и тестирования 
* Процедура для управления таблицей с логом: автоматическое партиционирование, удаление старой части логов. Для повышения скорости работы --- не делал
* Набор скриптов инициализации БД
* Скрипты для заполнения таблиц с тестовыми данными 

## Как запустить и посмотреть

* Поставить MS SQL SERVER или получить доступ к существующему
* Собрать самому в Visual Studio
* Запусть готовый собранный скрипт из проекта 
* Запустить test.sql со скриптом проверки работы 
* Таблица и процедуры записываются в схему logs

## Примеры использования 

Установить триггеры для логирования на таблицу 
exec logs.create_trigger 'НазваниеСхемы', 'НазваниеТаблицы' ,1- установить/0-только показать SQL
exec logs.create_trigger 'dbo', 'GOODS' ,1

Восстановить запись 
exec [logs].[restore_record] НомерСобытия,0 ,1 - восстановить/0-показать SQL 
exec [logs].[restore_record] 10,0 ,1

## Ограничения

* Нужен первичный ключ в таблице
* Не будет работать если не выполняются условия согласованности после модификации таблицы 
* Если у ключа есть свойство Identity - будет работать
